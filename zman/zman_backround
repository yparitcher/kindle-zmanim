#!/bin/sh

#####
# Copyright (c) 2019 Y Paritcher
#####

_FUNCTIONS=/etc/rc.d/functions
[ -f ${_FUNCTIONS} ] && . ${_FUNCTIONS}
WORKDIR=/mnt/us/zman
PROGRAM=$WORKDIR/program
DELTA=$WORKDIR/delta
export LANG=en_US.UTF-8
export LC_ALL=en_US.UTF-8


do_program()
{
	if [[ -f "$PROGRAM" ]]; then
		$PROGRAM
		msg "zman: new picture" I
	fi
}

wake_program()
{
	if [[ $(lipc-get-prop com.lab126.powerd state) == screenSaver ]]; then
	  do_program
	fi
}

run_program()
{
	if [[ -f "$DELTA" ]]; then
		$DELTA
		msg "zman: delta" I
	fi
}

lipc-wait-event -m com.lab126.powerd goingToScreenSaver,resuming,readyToSuspend | while read event; do
	case "$event" in
		goingToScreenSaver*)
			do_program;;
		resuming*)
			wake_program;;
		readyToSuspend*)
			run_program;;
	esac
done;

